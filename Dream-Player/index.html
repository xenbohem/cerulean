<!DOCTYPE html>  
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dream Portal Visualizer</title>
<style>
html,body{
  margin:0;
  background:#000;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100%;
  overflow:hidden;
}

#frame{
  width:520px;
  height:520px;
  background:linear-gradient(145deg,#082034,#0b3c66);
  border-radius:18px;
  padding:14px;
  box-shadow:0 0 40px #59ccff;
  position:relative;
}

canvas{
  background:linear-gradient(#020b16,#000000);
  border-radius:12px;
  width:100%;
  height:100%;
  display:block;
}

#controls{
  position:absolute;
  bottom:-60px;
  left:0; right:0;
  display:flex;
  justify-content:center;
  gap:12px;
}

button, input{
  background:#0c1b36;
  color:#89d8ff;
  border:none;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
}

button:hover{
  background:#174c75;
}
</style>
</head>

<body>

<div id="frame">
  <canvas id="c"></canvas>

  <div id="controls">
    <input type="file" id="file" accept="audio/*">
    <button onclick="audio.pause()">Pause</button>
    <button onclick="audio.play()">Play</button>
  </div>
</div>

<audio id="audio"></audio>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = canvas.clientWidth;
  canvas.height = canvas.clientHeight;
}
resize(); window.onresize=resize;

const audio = document.getElementById("audio");
const file = document.getElementById("file");

const ac = new AudioContext();
const src = ac.createMediaElementSource(audio);
const analyser = ac.createAnalyser();
analyser.fftSize = 256;
src.connect(analyser);
analyser.connect(ac.destination);

const data = new Uint8Array(analyser.frequencyBinCount);

// LOGO
const logo = new Image();
logo.src = "logo.png";

// STARS
const stars = [];
for(let i=0;i<60;i++){
  stars.push({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    r:Math.random()*1.5+0.4,
    t:Math.random()*Math.PI*2,
    tw:Math.random()*0.02+0.01
  });
}

// SNOW
const snowflakes = [];
for(let i=0;i<90;i++){
  snowflakes.push({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    r:Math.random()*2+0.6,
    s:Math.random()*0.8+0.3,
    d:Math.random()*0.4-0.2,
    melt:false
  });
}

file.onchange = e=>{
  audio.src = URL.createObjectURL(e.target.files[0]);
  audio.play();
  ac.resume();
};

function energy(){
  analyser.getByteFrequencyData(data);
  let sum=0;
  for(let i=0;i<data.length;i++) sum+=data[i];
  return sum/data.length;
}

let t=0;
function draw(){
  requestAnimationFrame(draw);
  t++;

  const e = energy() || 0;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  // â­ STARS
  for(let s of stars){
    s.t+=s.tw;
    let g=.4+Math.sin(s.t)*.4;
    ctx.fillStyle=`rgba(170,210,255,${g})`;
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  }

  // â„ï¸ MELTING SNOW
  for(let s of snowflakes){

    if(!s.melt){
      s.y+=s.s + e*0.01;
      s.x+=s.d;
      if(Math.random()<0.002) s.melt=true;
    }else{
      ctx.strokeStyle="rgba(140,200,255,0.15)";
      ctx.beginPath();
      ctx.arc(s.x,s.y,6,0,Math.PI*2);
      ctx.stroke();
      s.r-=0.05;
      if(s.r<.3){
        s.r=Math.random()*2+0.6;
        s.y=-5;
        s.x=Math.random()*canvas.width;
        s.melt=false;
      }
    }

    if(!s.melt){
      ctx.fillStyle="rgba(220,240,255,.85)";
      ctx.beginPath();
      ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
      ctx.fill();
    }

    if(s.y>canvas.height){
      s.y=-5; s.x=Math.random()*canvas.width;
    }
  }

  // ðŸŒŠ RIPPLE AURA
  ctx.strokeStyle="rgba(120,210,255,0.14)";
  for(let r=0;r<5;r++){
    ctx.beginPath();
    ctx.arc(canvas.width/2, canvas.height/2, 120+r*12 + Math.sin(t*0.02+r)*10 + e*0.3, 0,Math.PI*2);
    ctx.stroke();
  }

  // ðŸ’« LOGO GLOW
  let pulse = 1 + e/300;
  ctx.save();
  ctx.shadowBlur = 30;
  ctx.shadowColor = "rgba(140,210,255,.8)";
  ctx.drawImage(logo,
    canvas.width/2-80*pulse,
    canvas.height/2-80*pulse,
    160*pulse,
    160*pulse
  );
  ctx.restore();

}

draw();
</script>

</body>
</html>
