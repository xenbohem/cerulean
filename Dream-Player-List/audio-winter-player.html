<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LuciDream Snowglobe Player</title>
<style>
html,body{
  margin:0;
  overflow:hidden;
  background:radial-gradient(circle,#01080f,#000);
  font-family:system-ui;
}
canvas{display:block}
#ui{
  position:fixed;
  bottom:12px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:10px;
  align-items:center;
  background:rgba(5,20,35,.75);
  padding:8px 14px;
  border-radius:16px;
  box-shadow:0 0 20px rgba(120,220,255,.4);
}
button{
  background:#0e3c5d;color:#cff;
  border:none;padding:6px 12px;
  border-radius:8px;cursor:pointer;
}
#progress{width:140px;height:6px;background:#021019;border-radius:20px;overflow:hidden}
#bar{height:100%;width:0;background:#72d8ff}
#status{font-size:12px;opacity:.7}
#playlist{
  position:fixed;right:0;top:50%;
  transform:translateY(-50%);
  width:220px;padding:10px;
  background:rgba(3,14,22,.8);
  color:#93dfff;
  border-radius:12px 0 0 12px;
}
#playlist h3{margin:0 0 6px}
#songs{list-style:none;margin:0;padding:0}
#songs li{
  padding:5px;border-radius:6px;cursor:pointer
}
#songs li:hover{background:rgba(120,220,255,.15)}
#songs li.active{background:#7de3ff;color:#001;}
</style>
</head>
<body>

<canvas id="c"></canvas>

<div id="ui">
<button id="playpause">Pause</button>
<div id="progress"><div id="bar"></div></div>
<span id="status">Click anywhere to enable audio</span>
</div>

<div id="playlist">
<h3>Playlist</h3>
<ul id="songs"></ul>
</div>

<audio id="audio" crossorigin="anonymous"></audio>

<script>
const c=document.getElementById("c"),ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
addEventListener("resize",resize);resize();

const audio=document.getElementById("audio");
const playpause=document.getElementById("playpause");
const bar=document.getElementById("bar");
const status=document.getElementById("status");
const songsUI=document.getElementById("songs");

const playlist=["yeshua-ext.2.mp3"];
let current=0, audioCtx, analyser, dataArray, src, ready=false;
let t=0;

/* LOGO */
const logo=new Image();
logo.src="logo.png";

/* SNOW PARTICLES */
const snow=[];
for(let i=0;i<160;i++)
  snow.push({a:Math.random()*Math.PI*2,r:Math.random()*140,y:Math.random()*140,s:0.5+Math.random()});

/* PLAYLIST UI */
function drawList(){
 songsUI.innerHTML="";
 playlist.forEach((s,i)=>{
  const li=document.createElement("li");
  li.textContent=(i+1)+" "+s;
  if(i===current) li.classList.add("active");
  li.onclick=()=>{
    current=i;
    audio.src=s;
    audio.play();
    drawList();
    status.textContent=s;
  };
  songsUI.appendChild(li);
 });
}

/* AUDIO INIT */
document.body.addEventListener("click",()=>{
 if(ready) return;
 audioCtx=new (window.AudioContext||window.webkitAudioContext)();
 analyser=audioCtx.createAnalyser(); analyser.fftSize=256;
 dataArray=new Uint8Array(analyser.frequencyBinCount);
 src=audioCtx.createMediaElementSource(audio);
 src.connect(analyser); analyser.connect(audioCtx.destination);
 audio.src=playlist[0];
 audio.play();
 ready=true;
 status.textContent=playlist[0];
 drawList();
},{once:true});

/* PLAY PAUSE */
playpause.onclick=()=>{
 if(audio.paused){audio.play();playpause.textContent="Pause"}
 else{audio.pause();playpause.textContent="Play"}
};

/* PROGRESS */
audio.ontimeupdate=()=>{
 if(audio.duration)
  bar.style.width=(audio.currentTime/audio.duration*100)+"%";
};

/* DRAW */
function draw(){
 ctx.clearRect(0,0,c.width,c.height);
 const cx=c.width/2,cy=c.height/2;
 t+=0.02;

 let energy=0,bass=0;
 if(ready){
  analyser.getByteFrequencyData(dataArray);
  let total=0;
  for(let i=0;i<dataArray.length;i++){
    total+=dataArray[i];
    if(i<10) bass+=dataArray[i];
  }
  energy=total/dataArray.length;
  bass=bass/10;
 }

 /* SNOWGLOBE CLIP */
 ctx.save();
 ctx.beginPath();
 ctx.arc(cx,cy,150,0,Math.PI*2);
 ctx.clip();

 /* SNOW */
 snow.forEach(p=>{
  p.y+=p.s+energy*.01;
  if(p.y>150)p.y=-150;
  const x=cx+Math.cos(p.a)*p.r;
  const y=cy+p.y;
  ctx.fillStyle="rgba(255,255,255,.7)";
  ctx.beginPath();
  ctx.arc(x,y,1.6,0,Math.PI*2);
  ctx.fill();
 });

 /* AURA */
 const glow=ctx.createRadialGradient(cx,cy,10,cx,cy,160);
 glow.addColorStop(0,`rgba(140,220,255,${.25+energy/255})`);
 glow.addColorStop(1,"rgba(0,0,0,0)");
 ctx.fillStyle=glow;
 ctx.beginPath();
 ctx.arc(cx,cy,160,0,Math.PI*2);
 ctx.fill();

 /* LOGO */
 if(logo.complete){
  const size=110+bass*.7;
  ctx.globalCompositeOperation="lighter";
  ctx.drawImage(logo,cx-size/2,cy-size/2,size,size);
  ctx.globalCompositeOperation="source-over";
 }

 ctx.restore();

 requestAnimationFrame(draw);
}
draw();
</script>

</body>
</html>
